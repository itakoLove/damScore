<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>DAMスコア</title>
		<script>
			const xhr = new XMLHttpRequest();
			const url = 'https://damscore-back.to8823.workers.dev/api/get/score?clubdamcardno=ODAwMDA0NTQ3ODM2MzM5';
			xhr.open("GET", url);
			xhr.send();

			xhr.onreadystatechange = (e) => {
				if (xhr.readyState === XMLHttpRequest.DONE) {
					const status = xhr.status;
					if (status === 0 || (status >= 200 && status < 400)) {
						const scoreList = JSON.parse(xhr.responseText);
						
						scoreList.sort((a,b) => Number(b.scoringDxgId) - Number(a.scoringDxgId));

						const ce = a => document.createElement(a);
						let tableElem = ce('table');
						
						let headerElem = ce('tr');
						for (let headerItem of ['曲名', 'アーティスト名', '総合得点', '音程正確率', '安定性点数', '表現点数', 'ビブラート＆ロングトーン点数', 'リズム点数', '採点日時']) {
							let headerItemElem = ce('th');
							headerItemElem.innerText = headerItem;
							headerElem.appendChild(headerItemElem);
						}
						tableElem.appendChild(headerElem);

						for (let score of scoreList) {
							let scoreElem = ce('tr');
							
							let totalPoints = (score.totalPoints / 1000).toFixed(3);

							let scoringDateTime = score.scoringDateTime;
							scoringDateTime = scoringDateTime.substr(0,4) + '/' + scoringDateTime.substr(4,2) + '/' + scoringDateTime.substr(6,2) + ' ' + scoringDateTime.substr(8,2) + ':' + scoringDateTime.substr(10,2) + ':' + scoringDateTime.substr(12,2);

							for (let dataItem of [score.contentsName, score.artistName, totalPoints, score.radarChartPitch, score.radarChartStability, score.radarChartExpressive, score.radarChartVibratoLongtone, score.radarChartRhythm, scoringDateTime]) {
								let dataItemElem = ce('td');
								dataItemElem.innerText = dataItem;
								scoreElem.appendChild(dataItemElem);
							}

							tableElem.appendChild(scoreElem);
						}
						
						document.querySelector('#list1').appendChild(tableElem);

					}
				}
			}

		</script>
	</head>
	<body>
		<h1>DAMスコア</h1>
		
		<div id="list1">
		</div>
		<div id="list2">
		</div>
		
	</body>
</html>
